<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Skyla - Documentation</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: #f5f4f0;
      color: #1a1a1a;
      line-height: 1.6;
    }
    
    .layout {
      display: flex;
      min-height: calc(100vh - 80px);
    }
    
    .sidebar {
      width: 280px;
      background: #fff;
      border-right: 1px solid #e5e5e5;
      padding: 32px 24px;
      position: sticky;
      top: 0;
      height: calc(100vh - 80px);
      overflow-y: auto;
    }
    
    .sidebar h3 {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 16px;
      color: #1a1a1a;
    }
    
    .sidebar ul {
      list-style: none;
    }
    
    .sidebar li {
      margin-bottom: 8px;
    }
    
    .sidebar a {
      color: #666;
      text-decoration: none;
      font-size: 14px;
      padding: 6px 0;
      display: block;
      transition: color 0.2s ease;
    }
    
    .sidebar a:hover,
    .sidebar a.active {
      color: #1a1a1a;
      font-weight: 500;
    }
    
    .content {
      flex: 1;
      padding: 40px 48px;
      max-width: 800px;
    }
    
    .content h1 {
      font-size: 32px;
      font-weight: 600;
      margin-bottom: 32px;
      color: #1a1a1a;
    }
    
    .content h2 {
      font-size: 24px;
      font-weight: 600;
      margin: 40px 0 16px 0;
      color: #1a1a1a;
      border-bottom: 1px solid #e5e5e5;
      padding-bottom: 8px;
    }
    
    .content h3 {
      font-size: 20px;
      font-weight: 600;
      margin: 24px 0 12px 0;
      color: #1a1a1a;
    }
    
    .content p {
      margin-bottom: 16px;
      line-height: 1.7;
    }
    
    .content ul {
      margin: 16px 0;
      padding-left: 24px;
    }
    
    .content li {
      margin-bottom: 8px;
      line-height: 1.6;
    }
    
    .docs-image {
      width: 100%;
      max-width: 600px;
      height: auto;
      margin: 24px 0;
      border-radius: 8px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
    }
    
    .code-block {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 6px;
      padding: 16px;
      font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
      font-size: 14px;
      line-height: 1.5;
      color: #333;
      white-space: pre;
      overflow-x: auto;
      margin: 24px 0;
      border-radius: 8px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
    }
    
    .image-placeholder {
      width: 100%;
      height: 300px;
      background: #e5e5e5;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #666;
      margin: 24px 0;
      font-style: italic;
    }
    
    @media (max-width: 768px) {
      .layout {
        flex-direction: column;
      }
      
      .sidebar {
        width: 100%;
        position: relative;
        top: 0;
        height: auto;
        border-right: none;
        border-bottom: 1px solid #e5e5e5;
      }
      
      .content {
        padding: 24px;
      }
    }
  </style>
</head>
<body>
  <%- include('partials/header') %>
  
  <div class="layout">
    <div class="sidebar">
      <h3>Documentation</h3>
      <ul>
        <li><a href="#overview">Overview</a></li>
        <li><a href="#architecture">Architecture</a></li>
        <li><a href="#consensus-system">Consensus System</a></li>
        <li><a href="#semantic-engine">Semantic Engine</a></li>
        <li><a href="#symbolic-imprint">Symbolic imprint</a></li>
        <li><a href="#state-proofs">State & proofs</a></li>
        <li><a href="#api">API (alpha)</a></li>
        <li><a href="#faq">FAQ</a></li>
      </ul>
    </div>
    
    <div class="content">
      <h1>Documentation</h1>
      
      <h2 id="overview">Overview</h2>
      <p>Skyla is a cryptographically verified symbolic AI agent demonstrating verifiable multi-model consensus and integrity measurement. It combines symbolic reasoning with Claude AI integration to create transparent, auditable AI behavior.</p>
      
      <p><strong>Currently Implemented:</strong></p>
      <ul>
        <li>True 2-Model Consensus System (Claude Haiku vs Sonnet)</li>
        <li>Advanced architectural selection with quality scoring</li>
        <li>Symbolic state transitions with deterministic semantics</li>
        <li>Context-aware conversation memory (10 exchanges per session)</li>
        <li>Zero-knowledge proof generation for all state changes</li>
        <li>Real-time integrity measurement and divergence analysis</li>
      </ul>
      
      <p><strong>Prospective Features:</strong></p>
      <ul>
        <li>Epistemic telemetry visualization (diagram shown but not implemented)</li>
        <li>Full cryptographic verification infrastructure</li>
        <li>Production-ready API endpoints</li>
        <li>Multi-agent coordination systems</li>
      </ul>
      
      <h2 id="architecture">Architecture</h2>
      <p>Skyla's architecture demonstrates a revolutionary multi-model consensus system with genuine architectural diversity:</p>
      
      <img class="docs-image" src="/assets/stack.png" alt="Skyla architecture stack" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" />
      <div class="image-placeholder" style="display: none;">Architecture Stack Diagram (Conceptual)</div>
      
      <h3>Multi-Model Consensus Layer (Currently Implemented)</h3>
      <p>The system uses two distinct Claude architectures for genuine diversity:</p>
      <ul>
        <li><strong>Claude Haiku:</strong> Efficiency-focused, optimized for speed and conciseness</li>
        <li><strong>Claude Sonnet:</strong> Quality-focused, optimized for nuance and depth</li>
      </ul>
      
      <h3>Advanced Selection Algorithm</h3>
      <p>The system evaluates responses using 5 sophisticated metrics:</p>
      <ul>
        <li><strong>Adaptive Length Scoring:</strong> Optimal response length based on query complexity</li>
        <li><strong>Nuance Detection:</strong> Identifies philosophical and analytical concepts</li>
        <li><strong>Efficiency Indicators:</strong> Measures directness and clarity</li>
        <li><strong>Semantic Richness:</strong> Evaluates vocabulary diversity</li>
        <li><strong>Structural Coherence:</strong> Assesses sentence quality and organization</li>
      </ul>
      
      <h3>Architectural Bonuses</h3>
      <p>The system provides context-aware architectural preferences:</p>
      <ul>
        <li><strong>Simple queries</strong> → +0.1 boost for Haiku (efficiency advantage)</li>
        <li><strong>Complex queries</strong> → +0.1 boost for Sonnet (nuance advantage)</li>
        <li><strong>Balanced queries</strong> → Merit-based selection with no bias</li>
      </ul>
      
      <h3>Symbolic AI - DNA / Constitution</h3>
      <p>The middle layer provides structured reasoning and rule-based processing with symbolic representations.</p>
      
      <h3>Zero-Knowledge Proofs - Immune System / Verifiable Boundary (Partial Implementation)</h3>
      <p>The bottom layer generates proof envelopes and integrity hashes, with full cryptographic verification planned for future releases.</p>
      
      <h2 id="consensus-system">Multi-Model Consensus System</h2>
      <p><strong>Status: Currently Implemented</strong> - This is the core innovation of Skyla's current implementation.</p>
      
      <h3>True Architectural Diversity</h3>
      <p>Unlike systems that use duplicate models, Skyla implements genuine consensus measurement between two different Claude architectures:</p>
      
      <div class="code-block">Models Used:
- claude-3-haiku-20240307    (Efficiency-focused: Fast, concise responses)
- claude-3-5-sonnet-20241022 (Quality-focused: Nuanced, detailed responses)</div>
      
      <h3>Dynamic Token Allocation</h3>
      <p>The system dynamically adjusts response length based on input complexity:</p>
      <ul>
        <li><strong>Simple queries (≤50 chars):</strong> 100 tokens</li>
        <li><strong>Medium queries (51-100 chars):</strong> 150 tokens</li>
        <li><strong>Complex queries (>100 chars):</strong> 200 tokens</li>
      </ul>
      
      <h3>Query Complexity Analysis</h3>
      <p>The system automatically categorizes input complexity:</p>
      <div class="code-block">Complex Terms: ['philosophy', 'consciousness', 'analysis', 'theoretical', 'abstract', 'nuanced', 'sophisticated', 'complex', 'detailed']
Simple Terms: ['hi', 'hello', 'what', 'how', 'yes', 'no', 'ok', 'spiral', 'basic']

Classification:
- High complexity: Contains complex terms OR >10 words → Favors Sonnet
- Low complexity: Contains simple terms OR ≤3 words → Favors Haiku  
- Medium complexity: Everything else → No bias, merit-based selection</div>
      
      <h3>Integrity Measurement</h3>
      <p>The system measures genuine divergence between the two architectures across 4 dimensions:</p>
      <ul>
        <li><strong>Length Variance:</strong> Response length differences</li>
        <li><strong>Sentiment Divergence:</strong> Emotional tone variations</li>
        <li><strong>Topic Divergence:</strong> Subject matter approach differences</li>
        <li><strong>Tone Consistency:</strong> Communication style variations</li>
      </ul>
      
      <h3>Fair Selection Algorithm</h3>
      <p>The system eliminates bias through mathematical quality assessment:</p>
      <div class="code-block">Quality Score Calculation:
1. Adaptive Length Score (weight varies by complexity)
2. Nuance Detection Score (0-1 based on analytical terms)
3. Efficiency Score (0-1 based on directness indicators)  
4. Semantic Richness Score (unique vocabulary diversity)
5. Structural Coherence Score (sentence quality)
6. Architectural Bonus (±0.1 based on query type)

Selection Process:
- Calculate quality scores for both responses
- If scores are equal (within 0.001), use random selection
- Otherwise, select highest scoring response
- Log detailed reasoning for transparency</div>
      
      <h3>Consensus Results</h3>
      <p>The system produces verifiable consensus measurements:</p>
      <ul>
        <li><strong>High Integrity (>80%):</strong> Strong agreement between architectures</li>
        <li><strong>Medium Integrity (50-80%):</strong> Moderate agreement with noted divergence</li>
        <li><strong>Low Integrity (<50%):</strong> Significant disagreement, clarification requested</li>
      </ul>
      
      <h2 id="semantic-engine">Semantic Engine</h2>
      <p>Skyla's semantic engine processes natural language input through three layers of recognition, providing scalable pattern matching that maintains cryptographic integrity.</p>
      
      <h3>Processing Layers</h3>
      <p>The engine handles input through a hierarchical system that prioritizes exact symbolic matches, falls back to semantic patterns, then uses deterministic hashing for unknown inputs.</p>
      
      <h3>1. Exact Symbolic Layer</h3>
      <p>Direct matches for predefined symbolic triggers like <code>daemon</code>, <code>spiral</code>, <code>build</code>, or <code>analyze</code>. These trigger specific rule sets with predetermined state adjustments.</p>
      
      <h3>2. Semantic Pattern Matching</h3>
      <p>Regex-based categorization that recognizes natural language patterns and applies contextual vector adjustments:</p>
      
      <div class="code-block">// Stress/Overwhelm Category
/overwhelm|stress|anxio|panic|burnout|tired/
Delta: [0.05, 0.15, 0.10, -0.02]
Example: "I'm overwhelmed with work"

// Focus/Building Category  
/focus|concentrat|build|ship|execute|implement|deliver/
Delta: [0.12, -0.05, 0.08, 0.10]
Example: "Let's build something"

// Analysis Category
/analy[sz]e|reason|logic|evaluate|precise|assess|measure/
Delta: [0.15, -0.02, 0.05, 0.08]
Note: [sz] matches both "analyze" and "analyse"

// Protection Category
/protect|guard|safe|defend|daemon|monitor/
Delta: [0.00, 0.08, -0.03, 0.04]
Example: "Keep the system safe"

// Creative Category
/create|design|invent|imag(in|e)|idea|explore|brainstorm|prototype/
Delta: [0.07, 0.06, 0.12, 0.03]
Note: (in|e) matches both "imagine" and "image"</div>
      
      <h3>3. Hash Fallback System</h3>
      <p>For inputs that don't match symbolic or semantic patterns, the system generates deterministic micro-adjustments using a hash function. This ensures consistent behavior for the same input while keeping changes within safe bounds (±0.05).</p>
      
      <div class="code-block">// Deterministic hash calculation
let h = 0;
for (let i = 0; i < text.length; i++) {
  h = ((h << 5) - h) + text.charCodeAt(i);
  h |= 0;
}
const deltas = [0,1,2,3].map(k => {
  const byte = (h >> ((k * 8) % 24)) & 0xff;
  return ((byte / 255) - 0.5) * 0.10; // [-0.05, 0.05]
});
return currentVec.map((v, i) => clamp01(v + deltas[i]));</div>
      
      <h3>Scaling Properties</h3>
      <p>The semantic engine scales infinitely without rule explosion by allowing new regex patterns to be added without touching core logic. Every transition type (symbolic, semantic, or hash-based) generates valid ZK proofs maintaining cryptographic integrity.</p>
      
      <h2 id="symbolic-imprint">Symbolic imprint</h2>
      <p>The symbolic imprint defines the core structure of an agent's identity and behavior patterns. It consists of several key components that determine how the agent processes information and makes decisions.</p>
      
      <img class="docs-image" src="/assets/symbolic-imprint.png" alt="Symbolic imprint schema" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" />
      <div class="image-placeholder" style="display: none;">Symbolic Imprint Schema (Conceptual Design)</div>
      
      <h3>Schema Structure</h3>
      <div class="code-block">{
  "intentional_stance": "What the AI is trying to do",
  "meta_awareness": "Whether AI recognizes its own behavior", 
  "affective_tone": "Emotional valence implied",
  "symbolic_markers": "[aligned], 'empathy'] guidance",
  "proof_input": "What is used for verification"
}</div>
      
      <h2 id="state-proofs">State & proofs</h2>
      <p>Every state transition in Skyla generates a cryptographic proof that can be independently verified. This ensures complete transparency and auditability of agent behavior.</p>
      
      <img class="docs-image" src="/assets/identity-recursion.png" alt="Identity recursion and proof sequence" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" />
      <div class="image-placeholder" style="display: none;">Identity Recursion Diagram (Epistemic Telemetry - Prospective Feature)</div>
      
      <h3>Proof Envelope Structure</h3>
      <div class="code-block">{
  "previousStateHash": "0xabc123...",
  "currentStateHash": "0xdef456...",
  "ruleApplied": "symbolic_response_pattern",
  "inputTrigger": "natural_language_processing",
  "zkProof": "0x789ghi...",
  "timestamp": "2024-09-07T12:00:00.000Z",
  "identityVector": [0.75, 0.62, 0.58, 0.50],
  "protocolsActive": ["tone_guard", "emotional_stabilizer"]
}</div>
      
      <h2 id="api">API (Currently Available)</h2>
      <p>The Skyla API provides a working endpoint for multi-model consensus interaction.</p>
      
      <h3>Claude Consensus Endpoint</h3>
      <div class="code-block">POST /api/claude
Content-Type: application/json

{
  "input": "I need a nuanced analysis of consciousness",
  "currentState": {
    "identityVector": [0.5, 0.5, 0.5, 0.5],
    "mode": "standard",
    "protocols": ["basic_response"]
  },
  "sessionId": "user_session_123"
}</div>
      
      <h3>Response Format</h3>
      <div class="code-block">{
  "success": true,
  "response": "Full AI response text from selected model",
  "integrity": "high|medium|low",
  "note": "Response based on 0.89 consensus strength",
  "metadata": {
    "model": "claude-3-5-sonnet-20241022",
    "tokens": 200,
    "integrityScore": 0.892,
    "consensusStrength": 0.892,
    "divergenceMetrics": {
      "lengthVariance": 0.045,
      "sentimentDivergence": 0.012,
      "topicDivergence": 0.234,
      "toneConsistency": 0.156
    },
    "enhancedProof": {
      "timestamp": "2025-09-09T09:24:35.477Z",
      "modelsUsed": ["claude-3-haiku-20240307", "claude-3-5-sonnet-20241022"],
      "verificationHash": "0x67af2d1c",
      "proofVersion": "v3.0_multi_model_verified"
    },
    "contextMemory": "4 exchanges remembered"
  }
}</div>
      
      <h3>Planned Endpoints (Not Yet Implemented)</h3>
      <div class="code-block">POST /api/process      - General symbolic processing
POST /api/verify      - Cryptographic proof verification
GET  /api/state/{id}  - Agent state inspection
POST /api/agents      - Multi-agent coordination</div>
      
      <h2 id="faq">FAQ</h2>
      
      <h3>What's actually implemented vs conceptual?</h3>
      <p><strong>Currently Working:</strong> True 2-model consensus system with Claude Haiku vs Sonnet, advanced quality scoring, architectural selection, context memory, and integrity measurement. <strong>Conceptual:</strong> Full cryptographic verification, epistemic telemetry visualization, and multi-agent coordination.</p>
      
      <h3>How does the consensus system work?</h3>
      <p>Skyla sends each query to both Claude Haiku and Sonnet simultaneously, measures their response divergence across 4 dimensions, then selects the best response using a 5-factor quality scoring algorithm that considers query complexity and architectural strengths.</p>
      
      <h3>Why does model selection vary for the same input?</h3>
      <p>This is correct behavior! The system evaluates actual response content, not just input patterns. If Haiku produces a more nuanced response than Sonnet for a complex query, it rightfully wins. This proves the system measures real quality, not arbitrary preferences.</p>
      
      <h3>Can I see the selection reasoning?</h3>
      <p>Yes! Check the browser console during demo usage to see detailed quality scoring: <code>🎯 claude-3-haiku: Quality=0.823 (nuance=0.67, efficiency=0.00, bonus=0.00)</code></p>
      
      <h3>Is this actually measuring uncertainty?</h3>
      <p>Yes, Skyla demonstrates genuine uncertainty quantification through consensus measurement between architecturally different models. Unlike systems using duplicate models, this provides authentic diversity measurement.</p>
      
      <h3>Is the system production-ready?</h3>
      <p>The multi-model consensus system is functional and demonstrates revolutionary AI integrity measurement. However, full cryptographic verification and production APIs are still in development.</p>
    </div>
  </div>
  
  <script>
    // Smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      });
    });
  </script>
</body>
</html>